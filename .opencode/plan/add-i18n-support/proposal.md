# add-i18n-support: 添加国际化功能

## 概述

为系统添加完整的国际化(i18n)支持，实现中英文实时切换功能。

## 背景

当前系统所有用户界面文本均为硬编码的中文或英文，缺少多语言支持机制。用户无法根据个人偏好选择界面语言，这限制了系统的可用性和可访问性。

## 目标

- 实现轻量级i18n框架，不引入额外运行时依赖
- 支持中文(zh-CN)和英文(en-US)两种语言
- 切换语言时实时刷新当前页面以应用新语言
- 持久化用户语言偏好设置（登录用户从数据库，未登录用户从localStorage）

## 非目标

- 不引入重型i18n库(如next-intl, react-i18next)
- 不包含其他语言（初期仅中文和英文）
- API响应消息国际化仅限错误提示等通用消息

## 范围

### 包含

- i18n基础设施(React Context + 翻译字典)
- 语言切换组件
- 登录页面翻译
- Dashboard所有页面翻译
- API响应消息的国际化
- 语言偏好持久化存储（localStorage + 数据库）
- 翻译检查工具

### 不包含

- 数据库存储内容的翻译（如用户自定义的任务名称等）
- 第三方库或组件的翻译

## 方案概述

采用React Context实现轻量级i18n解决方案：

1. **翻译存储结构**：JSON格式的键值对字典，按模块组织
2. **语言上下文**：使用React Context管理当前语言状态
3. **持久化**：localStorage存储用户语言偏好，登录用户同步到数据库
4. **语言切换**：完整页面刷新确保所有组件重新渲染
5. **默认语言**：默认为中文，自动检测浏览器语言偏好

## 技术决策

| 决策点 | 选择 | 理由 |
|--------|------|------|
| 实现方案 | React Context | 无需额外依赖，与现有技术栈一致 |
| 存储格式 | JSON对象 | 简单直观，易于维护 |
| 刷新策略 | 完整页面刷新 | 确保所有组件重新渲染，状态一致 |
| 默认语言 | 中文 | 符合项目原始设计意图 |
| 持久化 | localStorage + 数据库 | 支持游客和登录用户 |
| API消息 | 同时国际化 | 提升非中文用户的使用体验 |
| 命名空间 | 按页面/模块分离 | 避免单文件过大，支持按需加载 |

## 用户故事

1. **游客**：首次访问时，系统默认为中文，可通过语言切换器切换到英文，语言偏好保存至localStorage
2. **注册用户**：登录后语言偏好同步到数据库，之后访问自动应用保存的语言设置
3. **切换语言**：用户点击语言切换按钮，页面刷新并以新语言显示
4. **API错误消息**：非中文用户可看到英文的API错误提示

## 验收标准

- [ ] 用户可在界面上切换中文/英文
- [ ] 切换语言后页面自动刷新
- [ ] 未登录用户语言偏好保存至localStorage
- [ ] 登录用户语言偏好保存至数据库
- [ ] 所有Dashboard页面文本正确翻译
- [ ] 登录页面文本正确翻译
- [ ] API响应消息支持中英文
- [ ] 浏览器语言自动检测
- [ ] 新增翻译条目不影响现有功能
- [ ] 语言切换组件在所有页面可见

## 风险与缓解

| 风险 | 缓解措施 |
|------|----------|
| 翻译覆盖不全 | 建立翻译检查清单，逐步完善 |
| 维护成本增加 | 采用模块化结构，减少耦合 |
| 性能影响 | 使用Context而非库，减少运行时开销 |
| API消息格式变更 | API消息国际化独立配置，易于更新 |

## 依赖

无外部依赖，仅使用React内置功能。

## 相关变更

此变更独立完成，不依赖其他待处理变更。

## 成功指标

- 100%的UI文本可翻译
- 页面加载性能无明显下降
- 零翻译错误导致的UI异常
- 语言切换响应时间 < 500ms
