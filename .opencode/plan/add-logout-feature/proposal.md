# add-logout-feature: 添加退出登录功能

## 概述

为系统添加退出登录功能，用户点击导航栏中的退出图标后可以安全退出并返回登录页面。

## 背景

当前系统缺少退出登录功能，用户无法从Dashboard退出系统。导航栏底部有一个退出图标（目前链接到错误的页面），需要实现真正的退出登录逻辑。

## 为什么

1. **用户体验**：用户需要能够退出系统以切换账号或保护隐私
2. **安全性**：退出时需要清除认证信息，防止未授权访问
3. **完整性**：登录和注册功能已实现，退出是认证流程的必要组成部分

## 什么变化

- 新增 `/api/auth/logout` API端点
- 修改 `topnav.tsx` 中的退出图标，添加点击事件处理
- 退出时清除 localStorage 中的认证信息
- 退出后重定向到登录页面

## 目标

- 用户点击退出图标后清除认证状态
- 清除 localStorage 中的保存的账号密码
- 重定向用户到登录页面
- 提供良好的用户反馈（可选的Toast提示）

## 非目标

- 不修改现有的登录/注册逻辑
- 不引入新的认证状态管理库
- 不修改数据库结构

## 范围

### 包含

- 创建退出登录API端点
- 修改topnav.tsx添加退出逻辑
- 清除localStorage认证数据
- 重定向到登录页面

### 不包含

- Session管理（当前使用localStorage）
- 记住我功能
- 多设备登录控制

## 方案概述

1. **API层**：创建 `/api/auth/logout/route.ts`，返回成功响应
2. **前端逻辑**：
   - 清除localStorage中的`lastLoginNickname`和`lastLoginPassword`
   - 调用退出API（可选）
   - 使用router重定向到登录页面

## 技术决策

| 决策点 | 选择 | 理由 |
|--------|------|------|
| 认证存储 | localStorage | 与现有登录实现一致 |
| 退出方式 | 客户端清除+路由跳转 | 简单直接，无需服务端会话 |
| 重定向 | Next.js router | 与应用路由系统一致 |
| 反馈 | Toast提示（可选） | 增强用户体验 |

## 用户故事

1. **已登录用户**：点击退出图标后清除认证信息并返回登录页面
2. **游客**：无法看到退出图标（或者点击后显示未登录提示）

## 验收标准

- [ ] 点击退出图标后清除localStorage中的认证信息
- [ ] 用户被重定向到登录页面
- [ ] 退出后返回登录页面无法访问受保护的路由
- [ ] 退出过程无错误

## 风险与缓解

| 风险 | 缓解措施 |
|------|----------|
| 网络问题导致退出失败 | 客户端清除优先于API调用 |
| 用户重复点击 | 添加loading状态 |

## 依赖

无外部依赖，使用现有技术栈。

## 相关变更

- 基于现有的认证系统 (`app/api/auth/`)
- 与i18n变更互补（可添加退出确认的多语言提示）
