## 上下文
项目当前仅有 1 个示例 E2E 测试（`e2e/example.spec.ts`），缺少单元测试和 API 集成测试。需要建立完整的测试金字塔，确保代码变更可验证。

## 目标 / 非目标
- 目标：建立 Vitest + Playwright 完整测试体系
- 目标：所有新功能必须包含测试
- 目标：测试失败时阻止变更完成
- 非目标：一次性覆盖所有现有代码（逐步补齐）
- 非目标：替换现有手动测试流程

## 决策
- **单元测试框架选择 Vitest**
  - 原因：与 Next.js/React 生态集成好，执行速度快
  - 替代：Jest（配置复杂），Vitest 更现代
- **测试文件位置**
  - 单元测试：`tests/unit/**/*.test.ts`
  - 集成测试：`tests/integration/**/*.test.ts`
  - E2E 测试：`e2e/**/*.spec.ts`
- **运行命令**
  - `pnpm test:unit` 运行单元测试
  - `pnpm test:integration` 运行集成测试
  - `pnpm test:e2e` 运行 E2E 测试
  - `pnpm test` 运行全部测试

## 测试覆盖标准
| 代码类型 | 最低覆盖要求 | 测试类型 |
|---------|-------------|---------|
| 工具函数 | 100% 分支 | 单元测试 |
| 组件 | 关键交互路径 | 单元测试 |
| API 路由 | 成功/失败场景 | 集成测试 |
| 认证流程 | 全路径 | E2E 测试 |

## 风险 / 权衡
- **风险**：初期测试编写成本高 → 缓解：混合方式，逐步补齐
- **风险**：测试维护负担 → 缓解：只测试公共接口，避免过度测试

## 迁移计划
1. 安装配置 Vitest
2. 创建测试工具函数和规范
3. 修改 OpenSpec 任务模板
4. 为新功能同步编写测试
5. 逐步补齐现有功能测试
