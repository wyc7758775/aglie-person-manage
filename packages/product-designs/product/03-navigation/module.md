# 导航架构 - 详细功能

> 本文档汇总了所有与导航架构相关的需求实现细节

## UI 设计规范文档

- **文档日期**: 20260219
- **文件位置**: packages/product-designs/UI设计规范-20260219/prd.md
- **主要模块**: 设计系统（本文档为关联内容）

---

## 品牌视觉系统升级 产品需求文档

- **文档日期**: 20260219
- **文件位置**: packages/product-designs/品牌视觉系统升级-20260219/prd.md
- **主要模块**: 设计系统（本文档为关联内容）

### 背景与目标

### 1.1 背景

当前系统存在品牌视觉不统一的问题：
- 侧边栏 Logo（太阳图标）与顶部导航 Logo（黑色方块星星）风格不一致
- 整体设计语言偏向现代但缺乏独特性
- 登录页面的温暖 Glassmorphism 风格未在内部页面延续
- 品牌记忆点不足，无法体现"人人都是产品经理"的产品理念

### 1.2 目标

- 建立统一的品牌视觉识别系统（VI）
- 将登录页面的温暖复古风格延伸至整个产品
- 创造独特的"打字机复古"视觉语言，致敬产品经理文化
- 提升产品专业感和温度感

### 1.3 成功指标

| 指标 | 目标值 | 衡量方式 |
|------|--------|----------|
| 品牌一致性 | 100% | 所有 Logo 使用统一复古徽章设计 |
| 风格覆盖率 | 100% | 登录页、仪表盘、项目页风格统一 |
| 视觉识别度 | 显著提升 | 用户能一眼识别品牌特征 |

---

### 功能需求

### 3.1 功能列表

| 功能模块 | 功能点 | 优先级 | 说明 |
|----------|--------|--------|------|
| Logo 统一 | 侧边栏 Logo 替换为复古徽章 | P0 | 统一使用古铜色渐变徽章设计 |
| Logo 统一 | 顶部导航 Logo 替换为复古徽章 | P0 | 统一使用古铜色渐变徽章设计 |
| 色彩系统 | 建立统一的复古配色方案 | P0 | 定义主色、功能色、中性色规范 |
| 字体系统 | 建立复古字体规范 | P1 | 正文、标题、品牌文字字体 |
| 组件规范 | 玻璃态卡片样式统一 | P1 | 统一卡片、按钮、标签样式 |
| 动效规范 | 统一动画时长和缓动函数 | P2 | 定义过渡、悬浮、加载动画 |

### 3.2 功能详细描述

#### 功能 A：Logo 统一替换为复古徽章设计

**描述**：将系统中所有 Logo 统一为复古徽章风格，包含侧边栏和顶部导航。

**设计规格：**

**视觉元素：**
- 尺寸：40x40px（标准）、32x32px（小尺寸适配）
- 形状：圆形徽章
- 渐变：`linear-gradient(135deg, #d4a574, #b8956a, #8b6914, #654321)`
- 边框：深褐色 `#5d4e37`，1px
- 内圈装饰线：米色 `#f5f5dc`，0.5px，60% 透明度

**中心内容：**
- 字母："B"
- 字体：Courier New，14px，bold
- 颜色：深褐色 `#3d2914`
- 字间距：-1px

**装饰元素：**
- 顶部圆点：琥珀金 `#e8b923`，半径 2px，90% 透明度（象征"运行"状态）
- 噪点纹理：SVG 滤镜，30% 透明度

**品牌文字：**
- 主标题："BE.RUN"
  - 字体：Courier New
  - 大小：10px（顶部导航）、12px（侧边栏）
  - 字重：bold
  - 字间距：widest（tracking-widest）
  - 颜色：侧边栏白色、顶部导航 `text-gray-700`
- 副标题："AGILE LIFE"
  - 字体：Courier New
  - 大小：6px（顶部导航）、8px（侧边栏）
  - 字间距：0.15em
  - 颜色：侧边栏 70% 白色、顶部导航 `text-gray-500`
  - 文字转换：大写

**用户流程**：
1. 用户打开登录页 → 看到复古徽章 Logo
2. 用户登录进入系统 → 侧边栏显示复古徽章 Logo
3. 用户浏览项目页 → 顶部导航显示复古徽章 Logo
4. 所有 Logo 视觉风格完全一致

**业务规则**：
- 所有 Logo 使用同一 SVG 组件，支持尺寸缩放
- 颜色根据背景自适应（侧边栏深色背景用白色文字，浅色背景用深色文字）
- 保持可访问性：Logo 包含 aria-label="BE.RUN 品牌 Logo"

---

#### 功能 B：建立统一色彩系统

**描述**：建立包含主色、功能色、中性色的完整配色方案，确保全系统色彩一致性。

**主色调定义：**

| 色彩名称 | Hex 值 | 用途 |
|----------|--------|------|
| 古铜金 | `#d4a574` | Logo 渐变起始 |
| 琥珀橙 | `#fb923c` | 强调色、CTA 按钮 |
| 深橙 | `#ea580c` | 悬停状态 |

**功能色定义：**

| 状态 | 颜色 | 背景 | 边框 |
|------|------|------|------|
| 正常 | emerald-500 | bg-emerald-50 | border-emerald-200 |
| 有风险 | amber-500 | bg-amber-50 | border-amber-200 |
| 失控 | rose-500 | bg-rose-50 | border-rose-200 |
| 高优先级 | rose-600 | bg-rose-50 | border-rose-200 |
| 中优先级 | amber-600 | bg-amber-50 | border-amber-200 |
| 低优先级 | slate-500 | bg-slate-50 | border-slate-200 |

**中性色定义：**

| 色彩名称 | Tailwind 类 | 用途 |
|----------|-------------|------|
| 纯白 | `white` | 卡片背景 |
| 浅灰 | `slate-50` | 页面背景 |
| 中灰 | `slate-400` | 次要文字 |
| 深灰 | `slate-700` | 正文文字 |
| 暗灰 | `slate-800` | 标题文字 |

**业务规则**：
- 所有颜色使用 Tailwind CSS 类，避免硬编码
- 特殊颜色（如古铜金）通过 Tailwind 配置扩展
- 确保所有颜色组合符合 WCAG 2.1 AA 对比度标准

---

#### 功能 C：建立字体规范

**描述**：定义全系统字体使用规范，包含正文、标题、品牌文字。

**字体家族：**

```css
/* 正文字体 */
font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;

/* 标题字体 */
font-family: 'Poppins', 'Noto Sans SC', sans-serif;

/* 品牌/复古字体 */
font-family: 'Courier New', Courier, monospace;
```

**字体规格表：**

| 样式 | 字体 | 大小 | 字重 | 行高 | 字间距 |
|------|------|------|------|------|--------|
| H1 | Poppins | 24px | 600 | 1.3 | -0.02em |
| H2 | Poppins | 20px | 600 | 1.3 | -0.02em |
| H3 | Poppins | 16px | 600 | 1.3 | -0.02em |
| Body | Noto Sans SC | 14px | 400 | 1.6 | 0.01em |
| Small | Noto Sans SC | 12px | 400 | 1.5 | 0.005em |
| Label | Noto Sans SC | 10px | 500 | 1.4 | 0.05em |
| Brand | Courier New | 10px | 700 | 1.2 | 0.1em |

**业务规则**：
- 中文字体使用 Noto Sans SC，确保良好的中文显示
- 标题使用 Poppins，增强现代感
- 品牌相关文字使用 Courier New，致敬打字机文化

---

#### 功能 D：玻璃态组件样式统一

**描述**：统一卡片、按钮、标签等组件的玻璃态（Glassmorphism）样式。

**卡片样式：**
```tsx
className="bg-white/80 backdrop-blur-xl rounded-2xl border border-white/60 shadow-xl"
```

**按钮样式：**
- 主按钮：蓝色渐变 + 阴影
- 次要按钮：白色半透明 + 边框

**标签样式：**
- 状态标签：圆点 + 文字
- 优先级标签：图标 + 文字

**业务规则**：
- 所有玻璃态元素使用 `backdrop-blur` 实现毛玻璃效果
- 边框使用半透明白色 `border-white/60`
- 阴影使用柔和的大面积阴影

---

### 验收标准

| 编号 | 验收项 | 验收方式 |
|------|--------|----------|
| AC-01 | 侧边栏显示复古徽章 Logo | 登录后查看侧边栏 |
| AC-02 | 顶部导航显示复古徽章 Logo | 进入项目页查看顶部 |
| AC-03 | 所有 Logo 视觉风格一致 | 对比侧边栏和顶部 Logo |
| AC-04 | Logo 品牌文字显示正确 | 确认 "BE.RUN" 和 "AGILE LIFE" 文字 |
| AC-05 | Logo 颜色在不同背景正常显示 | 侧边栏深色背景、顶部浅色背景 |
| AC-06 | 点击 Logo 可返回首页 | 点击验证跳转 |
| AC-07 | 整体色彩系统统一 | 检查卡片、按钮、标签颜色一致性 |

---

---

## Slow-Burn 项目字段优化 - 产品需求文档

- **文档日期**: 20260216
- **文件位置**: packages/product-designs/slow-burn项目优化-20260216/prd.md
- **主要模块**: 项目管理（本文档为关联内容）

### 背景与目标

### 1.1 背景

当前项目类型中 `slow-project` 的命名不够准确地表达其业务含义。Slow-burn（慢燃）更贴切地描述了这种项目的特性：缓慢而持续地积累，带有明确的目的性。同时，现有时间字段包含结束时间，而 slow-burn 项目本质上是持续积累型的，不需要固定截止日期。此外，slow-burn 项目需要一个指标系统来衡量进度和价值。

### 1.2 目标

- 将项目类型从 `slow-project` 重命名为 `slow-burn`，更准确地表达"有目的的积累"概念
- 移除 slow-burn 项目的结束时间字段，仅保留开始时间
- 统一所有时间展示为年月日格式（YYYY/MM/DD）
- 为 slow-burn 项目引入指标体系，支持多维度追踪进度
- 优化富文本编辑器，提升 Markdown 编辑体验

### 1.3 成功指标

| 指标 | 目标值 | 衡量方式 |
|------|--------|----------|
| 类型重命名 | slow-project → slow-burn | 代码审查 + 功能测试 |
| 时间字段 | 仅显示开始时间 | UI 审查 |
| 时间格式 | 统一为 YYYY/MM/DD | UI 审查 |
| 指标系统 | 支持添加/编辑/删除指标 | 功能测试 |
| 富文本编辑器 | 支持 MD 扩展格式 | 功能测试 |

---

### 功能需求

### 3.1 功能列表

| 功能模块 | 功能点 | 优先级 | 说明 |
|----------|--------|--------|------|
| 类型重命名 | slow-project → slow-burn | P0 | 修改类型标识、枚举值、数据库字段 |
| 时间字段 | 移除结束时间 | P0 | slow-burn 项目仅保留开始时间 |
| 时间格式 | 统一年月日展示 | P1 | 所有时间字段格式化为 YYYY/MM/DD |
| 指标系统 | 指标字段设计 | P0 | 对象数组，包含 value 和 weight |
| 指标系统 | 指标管理界面 | P1 | 添加/编辑/删除指标 |
| 指标系统 | 进度计算逻辑 | P1 | 基于指标权重计算总进度 |
| 富文本编辑器 | 默认行数调整 | P1 | 从默认行数改为 4 行 |
| 富文本编辑器 | MD 扩展支持 | P1 | Mermaid、代码块、强调、颜色 |
| 富文本编辑器 | 组件抽离 | P1 | 独立为 MarkdownEditor 组件 |

### 3.2 功能详细描述

#### 功能 A：项目类型重命名（slow-project → slow-burn）

**描述**：将项目类型标识从 `slow-project` 改为 `slow-burn`，并同步更新所有相关代码、数据库和国际化内容。

**变更范围**：
- TypeScript 类型定义
- 数据库枚举值
- API 接口参数校验
- 前端组件中的类型判断
- i18n 翻译文件
- 现有数据迁移

**业务规则**：
- 类型值从 `slow-project` 改为 `slow-burn`
- 显示名称从"长期项目"改为"慢燃项目"
- 表情符号保持 🌱 不变

**数据迁移**：
```sql
-- 更新项目类型
UPDATE projects SET type = 'slow-burn' WHERE type = 'slow-project';
```

---

#### 功能 B：移除 slow-burn 项目结束时间

**描述**：slow-burn 项目本质是持续积累型的，不需要固定结束时间，因此移除结束时间字段。

**用户流程**：
1. 用户创建 slow-burn 项目
2. 表单仅显示开始时间选择器
3. 用户选择开始时间
4. 保存后项目展示仅显示开始时间

**业务规则**：
- slow-burn 项目：仅保留 `start_time` 字段
- sprint-project 项目：保留 `start_time` 和 `end_time` 字段
- 数据库字段保留，仅前端根据类型控制显示
- 已有数据的结束时间保留但不再展示

**UI 调整**：

**冲刺项目（sprint-project）表单布局**：
```
┌────────────────────────────────────────────┐
│ 项目名称                                      │
│ [输入框]                                     │
├────────────────────────────────────────────┤
│ 项目类型    [下拉选择器]                       │
├────────────────────────────────────────────┤
│ 开始时间    [日期选择器]                       │
│ 结束时间    [日期选择器]                       │
├────────────────────────────────────────────┤
│ 项目描述                                      │
│ [Markdown编辑器]                             │
└────────────────────────────────────────────┘
```

**慢燃项目（slow-burn）表单布局**：
```
┌────────────────────────────────────────────┐
│ 项目名称                                      │
│ [输入框]                                     │
├────────────────────────────────────────────┤
│ 项目类型    [下拉选择器]                       │
├────────────────────────────────────────────┤
│ 开始时间    [日期选择器]                       │
│ （结束时间区域移除，下方区域上移）               │
├────────────────────────────────────────────┤
│ 积累指标                                      │
│ [指标管理区域]                               │
├────────────────────────────────────────────┤
│ 项目描述                                      │
│ [Markdown编辑器]                             │
└────────────────────────────────────────────┘
```

**布局调整说明**：
- 慢燃项目移除结束时间后，积累指标区域上移，填补原结束时间位置
- 保持表单整体视觉平衡，适当增加指标区域与描述区域的间距

---

#### 功能 C：时间格式统一为年月日

**描述**：所有时间展示统一格式化为 YYYY/MM/DD，移除时分秒信息，使界面更简洁。

**展示位置**：
- 项目卡片上的创建时间、更新时间
- 项目详情中的开始时间、结束时间
- 列表中的时间戳

**格式规则**：
- 格式：`YYYY/MM/DD`
- 本地化：根据用户语言自动调整（中文：2026/02/16，英文：02/16/2026）
- 不显示时分秒

**业务规则**：
- 存储格式保持不变（ISO 8601）
- 仅展示层格式化
- 使用工具函数统一处理：`formatDate(date: Date): string`

**异常处理**：
- 无效日期显示为"-"
- 空日期不显示

---

#### 功能 D：Slow-Burn 项目指标系统

**描述**：为 slow-burn 项目添加指标字段，支持定义多个积累指标，每个指标包含内容和权重，用于计算项目整体进度。

**数据结构**：
```typescript
interface ProjectIndicator {
  id: string;           // 指标唯一标识
  name: string;         // 指标名称（如"阅读页数"、"练习次数"）
  value: number;        // 当前值
  target: number;       // 目标值
  weight: number;       // 权重（0-100），所有指标权重之和为 100
}

// Project 类型扩展
interface Project {
  // ... 其他字段
  indicators?: ProjectIndicator[];  // 仅 slow-burn 项目使用
}
```

**用户流程**：
1. 用户创建 slow-burn 项目
2. 表单显示"积累指标"区域
3. 用户点击"添加指标"
4. 输入指标名称、目标值、权重
5. 可添加多个指标
6. 系统自动验证权重总和为 100
7. 保存后指标随项目存储

**进度计算逻辑**：

**核心公式**：
```
单个指标完成度 = min(100%, (value / target) * 100%)
项目总进度 = Σ(单个指标完成度 * 指标权重) / 100
```

**计算说明**：
1. **单个指标完成度上限**：单个指标完成度最高为 100%，即使 value > target，也按 100% 计算
2. **加权汇总**：每个指标的完成度乘以其权重，然后求和
3. **结果范围**：项目总进度范围为 0% - 100%

**计算示例**：
```
指标1：阅读页数
- 当前值：150
- 目标值：300
- 权重：60%
- 计算：min(100%, (150/300)*100%) * 60% = 50% * 60% = 30%

指标2：笔记数量
- 当前值：10
- 目标值：50
- 权重：40%
- 计算：min(100%, (10/50)*100%) * 40% = 20% * 40% = 8%

总进度：30% + 8% = 38%
```

**边界情况处理**：
| 场景 | 处理方式 |
|------|----------|
| target = 0 | 该指标完成度视为 0% |
| value >= target | 该指标完成度视为 100% |
| value < 0 | 按 0 处理 |
| 无指标 | 项目进度显示为 0% 或隐藏 |

**UI 设计**：
```
积累指标
┌─────────────────────────────────────┐
│ 指标名称    当前值    目标值    权重   │
│ [阅读页数]  [ 150 ]   [ 300 ]  [ 60%] │
│ [笔记数量]  [  10 ]   [  50 ]  [ 40%] │
│                                     │
│ [+ 添加指标]                        │
│                                     │
│ 当前进度：38% ████░░░░░░          │
└─────────────────────────────────────┘
```

**业务规则**：
- 仅 slow-burn 项目支持指标系统
- sprint-project 不显示指标区域
- 指标数量：至少 1 个，最多 10 个
- 权重规则：所有指标权重之和必须等于 100
- 指标值：当前值和目标值均为非负数
- 指标可编辑、可删除

**校验规则**：
| 字段 | 规则 | 错误提示 |
|------|------|----------|
| 指标名称 | 必填，1-50 字符 | 请输入指标名称 |
| 目标值 | 必填，正数 | 请输入有效的目标值 |
| 权重 | 必填，0-100 整数 | 请输入 0-100 之间的整数 |
| 权重总和 | 必须等于 100 | 所有指标权重之和必须等于 100% |

**异常处理**：
- 权重总和不等于 100 时阻止保存
- 删除指标时重新计算剩余指标权重（提示用户）
- 目标值为 0 时，该指标完成度按 100% 计算

---

#### 功能 E：富文本编辑器优化

**描述**：优化项目描述（适用于两种项目类型）的富文本编辑器，提升 Markdown 编辑体验。

**优化内容**：

##### E1：默认行数调整
- 从默认行数（2-3行）改为默认 4 行
- 最小高度：120px（4行 × 30px）
- 支持自动扩展（最大 10 行，超过显示滚动条）

##### E2：Markdown 扩展支持
新增以下 Markdown 语法支持：

| 功能 | 语法 | 说明 |
|------|------|------|
| Mermaid 流程图 | ```mermaid | 支持流程图、时序图、甘特图 |
| 代码块高亮 | ```javascript | 支持语法高亮 |
| 粗体 | **text** | 字体加重 |
| 斜体 | *text* | 斜体 |
| 删除线 | ~~text~~ | 删除线 |
| 文字颜色 | `u003cspan style="color:red"u003etextu003c/spanu003e` | 支持内联 HTML 颜色 |
| 任务列表 | - [ ] 任务 | 复选框列表 |
| 表格 | \| 表头 \| | 支持简单表格 |

##### E3：组件抽离
- 抽离为独立组件：`MarkdownEditor`
- 位置：`components/ui/markdown-editor.tsx`
- Props 设计：
```typescript
interface MarkdownEditorProps {
  value: string;
  onChange: (value: string) => void;
  placeholder?: string;
  minRows?: number;      // 默认 4
  maxRows?: number;      // 默认 10
  height?: number;       // 固定高度（可选）
  disabled?: boolean;
  showToolbar?: boolean; // 是否显示工具栏，默认 true
  className?: string;
}
```

**工具栏设计**：
```
┌─────────────────────────────────────────────────────┐
│  B  I  S  H1 H2 H3  • List  ☑ Task  <> Code  📊 Mermaid │
├─────────────────────────────────────────────────────┤
│                                                     │
│                                                     │
│                                                     │
│                                                     │
├─────────────────────────────────────────────────────┤
│ Markdown 支持  ·  字数: 128                        │
└─────────────────────────────────────────────────────┘
```

**工具栏按钮**：
- **B**：粗体（**text**）
- **I**：斜体（*text*）
- **S**：删除线（~~text~~）
- **H1/H2/H3**：标题
- **• List**：无序列表
- **☑ Task**：任务列表
- **`u003cu003e` Code**：代码块
- **📊 Mermaid**：Mermaid 图表

**实时预览**：
- 支持分屏模式：左侧编辑，右侧预览
- 支持全屏编辑

**业务规则**：
- 应用于所有项目类型的描述字段
- 向后兼容：纯文本描述正常显示
- 存储格式：Markdown 纯文本
- 渲染：使用 react-markdown 或类似库

**技术依赖（Tiptap 全家桶）**：
- **核心框架**：`@tiptap/react` + `@tiptap/core`
- **基础扩展**：`@tiptap/starter-kit`（包含 bold、italic、strike、heading、list、blockquote 等）
- **代码高亮**：`@tiptap/extension-code-block-lowlight` + `lowlight`
- **任务列表**：`@tiptap/extension-task-list` + `@tiptap/extension-task-item`
- **表格**：`@tiptap/extension-table` + `@tiptap/extension-table-row` + `@tiptap/extension-table-cell` + `@tiptap/extension-table-header`
- **Mermaid 图表**：自定义 Tiptap 节点扩展（集成 `mermaid`）
- **文字颜色**：`@tiptap/extension-color` + `@tiptap/extension-text-style`
- **链接**：`@tiptap/extension-link`
- **图片**：`@tiptap/extension-image`
- **日期处理**：date-fns 或 dayjs

---

## 导航架构调整 产品需求文档

- **文档日期**: 20260202
- **文件位置**: packages/product-designs/导航架构调整-20260202/prd.md
- **主要模块**: 项目管理（本文档为关联内容）

### 背景与目标

### 1.1 背景

当前系统导航中，**项目**、**需求**、**任务**、**缺陷**处于同一层级（一级导航），用户需在侧边栏频繁切换才能在不同项目下查看需求、任务或缺陷。这种平铺结构无法体现「需求、任务、缺陷隶属于项目」的业务关系，且项目切换时缺乏上下文感知。

### 1.2 目标

- 重构导航层级：Overview、Project、Rewards、Notifications、Settings 为一级导航；需求、任务、缺陷作为 Project 下的二级导航
- 点击项目后进入项目详情视图，顶部展示项目名、需求/任务/缺陷 Tab、返回项目列表入口
- 提升项目上下文感知，减少导航跳转次数
- 与现有功能（项目 CRUD、需求/任务/缺陷管理）无缝衔接

### 1.3 成功指标

| 指标 | 目标值 | 衡量方式 |
|------|--------|----------|
| 一级导航项 | 5 个 | 侧边栏仅显示：概览、项目、奖励、通知、设置 |
| 项目详情页二级导航 | 3 个 Tab | 需求、任务、缺陷 |
| 返回项目列表 | 可点击 | 文件夹图标或项目名下拉可返回项目列表 |
| 项目上下文 | 正确传递 | 需求/任务/缺陷列表按当前项目筛选 |

---

### 功能需求

### 3.1 功能列表

| 功能模块 | 功能点 | 优先级 | 说明 |
|----------|--------|--------|------|
| 一级导航 | 重构侧边栏导航项 | P0 | 仅保留：概览、项目、奖励、通知、设置 |
| 项目列表页 | 保持现有项目卡片列表 | P0 | 点击项目卡片进入项目详情页 |
| 项目详情页 | 顶部栏布局 | P0 | 文件夹图标 + 面包屑 + 项目名 + 下拉 + Tab（需求/任务/缺陷） |
| 项目详情页 | 返回项目列表 | P0 | 点击文件夹图标或下拉选择「返回项目列表」 |
| 项目详情页 | 项目切换 | P0 | 项目名下拉展示项目列表，选择后切换当前项目 |
| 项目详情页 | Tab 内容 | P0 | 需求/任务/缺陷 Tab 展示对应内容，按当前项目筛选 |

### 3.2 功能详细描述

#### 功能 A：一级导航重构

**描述**：将侧边栏（topnav）主导航从当前的「概览、项目、需求、任务、缺陷、奖励」调整为「概览、项目、奖励」，选项菜单保持「通知、设置」。需求、任务、缺陷从一级导航移除。

**用户流程**：
1. 进入 Dashboard
2. 侧边栏仅显示：概览、项目、奖励、通知、设置
3. 点击「项目」进入项目列表页

**业务规则**：
- 一级导航固定为 5 项：概览、项目、奖励、通知、设置
- 习惯、每日、待办等若存在，可并入「概览」或单独保留（本期以概览为主，习惯/每日/待办可暂保留在概览页内）
- 直接访问 `/dashboard/requirement`、`/dashboard/task`、`/dashboard/defect` 时，需重定向到项目列表或默认项目详情页（见路由设计）

**异常处理**：
- 无

---

#### 功能 B：项目列表页

**描述**：保持现有项目卡片列表，点击项目卡片进入项目详情页（含需求/任务/缺陷 Tab）。

**用户流程**：
1. 点击侧边栏「项目」
2. 进入项目列表页，展示所有项目卡片
3. 点击某项目卡片
4. 跳转至项目详情页，URL 形如 `/dashboard/project/[projectId]`，默认选中「需求」Tab

**业务规则**：
- 项目列表页 URL：`/dashboard/project` 或 `/dashboard/project/list`
- 无项目时显示空状态，引导用户新建项目
- 项目卡片点击行为：进入项目详情，而非打开抽屉（抽屉仍可通过卡片「更多」菜单的「编辑」触发）

**异常处理**：
- 项目 ID 无效 → 404 或重定向至项目列表

---

#### 功能 C：项目详情页顶部栏

**描述**：项目详情页顶部展示项目上下文栏，参考视觉稿布局。

**布局结构（自左至右）**：

| 区域 | 元素 | 说明 |
|------|------|------|
| 左侧 | 文件夹图标 | 点击返回项目列表 |
| 左侧 | 右箭头 `>` | 面包屑分隔符 |
| 左侧 | 项目名称 | 当前项目名，可点击展开下拉 |
| 左侧 | 下拉箭头 ∨ | 点击展开项目切换/返回列表菜单 |
| 中部 | 竖线分隔 | 视觉分隔 |
| 右侧 | 需求 Tab | 选中时蓝色文字+下划线 |
| 右侧 | 任务 Tab | 未选中时灰色/黑色文字 |
| 右侧 | 缺陷 Tab | 未选中时灰色/黑色文字 |

**用户流程**：
1. 从项目列表点击项目，进入项目详情页
2. 顶部栏显示：文件夹图标 > 项目名 ∨ | 需求 | 任务 | 缺陷
3. 点击「需求」「任务」「缺陷」切换 Tab，URL 可带 query 如 `?tab=requirement|task|defect`
4. 点击文件夹图标 → 返回项目列表
5. 点击项目名或下拉箭头 → 展开下拉菜单，可切换项目或选择「返回项目列表」

**业务规则**：
- 默认 Tab 为「需求」
- Tab 切换不刷新页面，仅切换内容区域
- 需求/任务/缺陷内容按当前 `projectId` 筛选
- 项目名下拉菜单：列出最近/全部项目，底部有「返回项目列表」选项

**异常处理**：
- 项目被删除 → 返回项目列表并提示

---

#### 功能 D：返回项目列表

**描述**：提供明确的返回项目列表入口。

**用户流程**：
1. 方式一：点击顶部栏左侧文件夹图标
2. 方式二：点击项目名或下拉箭头，在下拉菜单中选择「返回项目列表」
3. 跳转至 `/dashboard/project`（项目列表页）

**业务规则**：
- 两种方式均跳转至项目列表
- 浏览器后退按钮行为：可返回上一页（由路由实现决定）

**异常处理**：
- 无

---

#### 功能 E：项目切换

**描述**：在项目详情页通过项目名下拉菜单切换至另一项目。

**用户流程**：
1. 点击项目名或下拉箭头
2. 展开下拉菜单，展示项目列表（可限制显示数量，如最近 10 个）
3. 点击某项目
4. 切换当前项目，URL 更新为 `/dashboard/project/[newProjectId]`，Tab 保持当前选中（或重置为需求）
5. 内容区域刷新，展示新项目的需求/任务/缺陷

**业务规则**：
- 下拉菜单展示项目列表，按名称或最近使用排序
- 当前项目在列表中高亮或置顶
- 切换后 Tab 状态：建议保持（如当前在任务 Tab，切换项目后仍显示任务 Tab）

**异常处理**：
- 项目列表为空 → 仅显示「返回项目列表」

---

#### 功能 F：需求/任务/缺陷 Tab 内容

**描述**：三个 Tab 分别展示当前项目下的需求、任务、缺陷，复用现有需求页、任务页、缺陷页的组件与逻辑，增加 `projectId` 筛选。

**用户流程**：
1. 进入项目详情页，默认显示「需求」Tab
2. 需求 Tab：展示该项目的需求列表/看板
3. 任务 Tab：展示该项目的任务列表
4. 缺陷 Tab：展示该项目的缺陷列表（code 类型项目才显示，life 类型可隐藏或显示空状态）

**业务规则**：
- 需求 API：`GET /api/requirements?projectId=xxx`
- 任务 API：需支持按 projectId 筛选（若现有 API 无此参数，需扩展）
- 缺陷 API：需支持按 projectId 筛选（若现有 API 无此参数，需扩展）
- 缺陷 Tab：code 类型项目显示，life 类型可隐藏或提示「仅代码项目有缺陷」
- 各 Tab 内容区域复用现有 RequirementKanban、TaskCard、Defect 等组件

**异常处理**：
- 项目无需求/任务/缺陷 → 显示空状态
- API 失败 → 显示错误提示

---

### 验收标准

| 编号 | 验收项 | 验收方式 |
|------|--------|----------|
| AC-01 | 一级导航仅含概览、项目、奖励、通知、设置 | 侧边栏不显示需求、任务、缺陷 |
| AC-02 | 点击项目卡片进入项目详情页 | 跳转至 /dashboard/project/[id]，顶部显示项目名 |
| AC-03 | 项目详情页顶部栏包含文件夹图标、项目名、需求/任务/缺陷 Tab | 布局与视觉参考一致 |
| AC-04 | 点击文件夹图标返回项目列表 | 跳转至 /dashboard/project |
| AC-05 | 项目名下拉可切换项目、选择返回项目列表 | 下拉菜单功能正常 |
| AC-06 | 需求/任务/缺陷 Tab 切换正确展示对应内容 | 内容按当前项目筛选 |
| AC-07 | 直接访问 /dashboard/requirement 等旧路径 | 重定向至项目列表或默认项目详情 |
| AC-08 | 项目详情页编辑入口 | 通过内容区或顶部栏可打开项目编辑（抽屉/弹窗） |

---

---

