# 导航架构调整 产品需求文档

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档版本 | v1.0 |
| 作者 | |
| 创建日期 | 2026-02-02 |
| 更新日期 | 2026-02-02 |
| 状态 | 草稿 |
| 视觉参考 | `assets/image-be74b422-d824-4fbe-a962-d3bcb5cc60bb.png` |

---

## 1. 背景与目标

### 1.1 背景

当前系统导航中，**项目**、**需求**、**任务**、**缺陷**处于同一层级（一级导航），用户需在侧边栏频繁切换才能在不同项目下查看需求、任务或缺陷。这种平铺结构无法体现「需求、任务、缺陷隶属于项目」的业务关系，且项目切换时缺乏上下文感知。

### 1.2 目标

- 重构导航层级：Overview、Project、Rewards、Notifications、Settings 为一级导航；需求、任务、缺陷作为 Project 下的二级导航
- 点击项目后进入项目详情视图，顶部展示项目名、需求/任务/缺陷 Tab、返回项目列表入口
- 提升项目上下文感知，减少导航跳转次数
- 与现有功能（项目 CRUD、需求/任务/缺陷管理）无缝衔接

### 1.3 成功指标

| 指标 | 目标值 | 衡量方式 |
|------|--------|----------|
| 一级导航项 | 5 个 | 侧边栏仅显示：概览、项目、奖励、通知、设置 |
| 项目详情页二级导航 | 3 个 Tab | 需求、任务、缺陷 |
| 返回项目列表 | 可点击 | 文件夹图标或项目名下拉可返回项目列表 |
| 项目上下文 | 正确传递 | 需求/任务/缺陷列表按当前项目筛选 |

---

## 2. 用户与场景

### 2.1 目标用户

| 用户类型 | 描述 | 核心诉求 |
|----------|------|----------|
| 个人用户 | 使用系统管理生活/代码项目 | 按项目维度查看需求、任务、缺陷，快速切换项目 |

### 2.2 使用场景

| 场景 | 描述 | 频率 |
|------|------|------|
| 进入项目详情 | 从项目列表点击某项目，进入该项目的需求/任务/缺陷视图 | 高 |
| 切换项目内 Tab | 在需求、任务、缺陷之间切换，无需离开当前项目 | 高 |
| 返回项目列表 | 点击文件夹图标或通过下拉切换项目，回到项目选择列表 | 高 |
| 切换项目 | 在项目详情页通过下拉菜单切换到另一项目 | 中 |

### 2.3 用户故事

- **作为** 个人用户，**我希望** 一级导航仅包含概览、项目、奖励、通知、设置，**以便** 导航结构更清晰
- **作为** 个人用户，**我希望** 点击项目后，需求、任务、缺陷以 Tab 形式展示在界面顶部，**以便** 在项目上下文中快速切换
- **作为** 个人用户，**我希望** 项目详情页顶部显示当前项目名，**以便** 明确当前所在项目
- **作为** 个人用户，**我希望** 通过文件夹图标或项目名下拉返回项目列表，**以便** 快速切换或选择其他项目

---

## 3. 功能需求

### 3.1 功能列表

| 功能模块 | 功能点 | 优先级 | 说明 |
|----------|--------|--------|------|
| 一级导航 | 重构侧边栏导航项 | P0 | 仅保留：概览、项目、奖励、通知、设置 |
| 项目列表页 | 保持现有项目卡片列表 | P0 | 点击项目卡片进入项目详情页 |
| 项目详情页 | 顶部栏布局 | P0 | 文件夹图标 + 面包屑 + 项目名 + 下拉 + Tab（需求/任务/缺陷） |
| 项目详情页 | 返回项目列表 | P0 | 点击文件夹图标或下拉选择「返回项目列表」 |
| 项目详情页 | 项目切换 | P0 | 项目名下拉展示项目列表，选择后切换当前项目 |
| 项目详情页 | Tab 内容 | P0 | 需求/任务/缺陷 Tab 展示对应内容，按当前项目筛选 |

### 3.2 功能详细描述

#### 功能 A：一级导航重构

**描述**：将侧边栏（topnav）主导航从当前的「概览、项目、需求、任务、缺陷、奖励」调整为「概览、项目、奖励」，选项菜单保持「通知、设置」。需求、任务、缺陷从一级导航移除。

**用户流程**：
1. 进入 Dashboard
2. 侧边栏仅显示：概览、项目、奖励、通知、设置
3. 点击「项目」进入项目列表页

**业务规则**：
- 一级导航固定为 5 项：概览、项目、奖励、通知、设置
- 习惯、每日、待办等若存在，可并入「概览」或单独保留（本期以概览为主，习惯/每日/待办可暂保留在概览页内）
- 直接访问 `/dashboard/requirement`、`/dashboard/task`、`/dashboard/defect` 时，需重定向到项目列表或默认项目详情页（见路由设计）

**异常处理**：
- 无

---

#### 功能 B：项目列表页

**描述**：保持现有项目卡片列表，点击项目卡片进入项目详情页（含需求/任务/缺陷 Tab）。

**用户流程**：
1. 点击侧边栏「项目」
2. 进入项目列表页，展示所有项目卡片
3. 点击某项目卡片
4. 跳转至项目详情页，URL 形如 `/dashboard/project/[projectId]`，默认选中「需求」Tab

**业务规则**：
- 项目列表页 URL：`/dashboard/project` 或 `/dashboard/project/list`
- 无项目时显示空状态，引导用户新建项目
- 项目卡片点击行为：进入项目详情，而非打开抽屉（抽屉仍可通过卡片「更多」菜单的「编辑」触发）

**异常处理**：
- 项目 ID 无效 → 404 或重定向至项目列表

---

#### 功能 C：项目详情页顶部栏

**描述**：项目详情页顶部展示项目上下文栏，参考视觉稿布局。

**布局结构（自左至右）**：

| 区域 | 元素 | 说明 |
|------|------|------|
| 左侧 | 文件夹图标 | 点击返回项目列表 |
| 左侧 | 右箭头 `>` | 面包屑分隔符 |
| 左侧 | 项目名称 | 当前项目名，可点击展开下拉 |
| 左侧 | 下拉箭头 ∨ | 点击展开项目切换/返回列表菜单 |
| 中部 | 竖线分隔 | 视觉分隔 |
| 右侧 | 需求 Tab | 选中时蓝色文字+下划线 |
| 右侧 | 任务 Tab | 未选中时灰色/黑色文字 |
| 右侧 | 缺陷 Tab | 未选中时灰色/黑色文字 |

**用户流程**：
1. 从项目列表点击项目，进入项目详情页
2. 顶部栏显示：文件夹图标 > 项目名 ∨ | 需求 | 任务 | 缺陷
3. 点击「需求」「任务」「缺陷」切换 Tab，URL 可带 query 如 `?tab=requirement|task|defect`
4. 点击文件夹图标 → 返回项目列表
5. 点击项目名或下拉箭头 → 展开下拉菜单，可切换项目或选择「返回项目列表」

**业务规则**：
- 默认 Tab 为「需求」
- Tab 切换不刷新页面，仅切换内容区域
- 需求/任务/缺陷内容按当前 `projectId` 筛选
- 项目名下拉菜单：列出最近/全部项目，底部有「返回项目列表」选项

**异常处理**：
- 项目被删除 → 返回项目列表并提示

---

#### 功能 D：返回项目列表

**描述**：提供明确的返回项目列表入口。

**用户流程**：
1. 方式一：点击顶部栏左侧文件夹图标
2. 方式二：点击项目名或下拉箭头，在下拉菜单中选择「返回项目列表」
3. 跳转至 `/dashboard/project`（项目列表页）

**业务规则**：
- 两种方式均跳转至项目列表
- 浏览器后退按钮行为：可返回上一页（由路由实现决定）

**异常处理**：
- 无

---

#### 功能 E：项目切换

**描述**：在项目详情页通过项目名下拉菜单切换至另一项目。

**用户流程**：
1. 点击项目名或下拉箭头
2. 展开下拉菜单，展示项目列表（可限制显示数量，如最近 10 个）
3. 点击某项目
4. 切换当前项目，URL 更新为 `/dashboard/project/[newProjectId]`，Tab 保持当前选中（或重置为需求）
5. 内容区域刷新，展示新项目的需求/任务/缺陷

**业务规则**：
- 下拉菜单展示项目列表，按名称或最近使用排序
- 当前项目在列表中高亮或置顶
- 切换后 Tab 状态：建议保持（如当前在任务 Tab，切换项目后仍显示任务 Tab）

**异常处理**：
- 项目列表为空 → 仅显示「返回项目列表」

---

#### 功能 F：需求/任务/缺陷 Tab 内容

**描述**：三个 Tab 分别展示当前项目下的需求、任务、缺陷，复用现有需求页、任务页、缺陷页的组件与逻辑，增加 `projectId` 筛选。

**用户流程**：
1. 进入项目详情页，默认显示「需求」Tab
2. 需求 Tab：展示该项目的需求列表/看板
3. 任务 Tab：展示该项目的任务列表
4. 缺陷 Tab：展示该项目的缺陷列表（code 类型项目才显示，life 类型可隐藏或显示空状态）

**业务规则**：
- 需求 API：`GET /api/requirements?projectId=xxx`
- 任务 API：需支持按 projectId 筛选（若现有 API 无此参数，需扩展）
- 缺陷 API：需支持按 projectId 筛选（若现有 API 无此参数，需扩展）
- 缺陷 Tab：code 类型项目显示，life 类型可隐藏或提示「仅代码项目有缺陷」
- 各 Tab 内容区域复用现有 RequirementKanban、TaskCard、Defect 等组件

**异常处理**：
- 项目无需求/任务/缺陷 → 显示空状态
- API 失败 → 显示错误提示

---

## 4. 交互逻辑（前端）

### 4.1 原型链接

| 项目 | 内容 |
|------|------|
| 视觉参考 | 项目详情页顶部栏布局见 `assets/image-be74b422-d824-4fbe-a962-d3bcb5cc60bb.png` |
| 说明 | 截图展示：文件夹图标 > 项目名 ∨ \| 需求（选中）\| 任务 \| 缺陷 |

### 4.2 路由设计

| 路径 | 说明 |
|------|------|
| `/dashboard/project` | 项目列表页 |
| `/dashboard/project/[projectId]` | 项目详情页，默认需求 Tab |
| `/dashboard/project/[projectId]?tab=requirement` | 项目详情页，需求 Tab |
| `/dashboard/project/[projectId]?tab=task` | 项目详情页，任务 Tab |
| `/dashboard/project/[projectId]?tab=defect` | 项目详情页，缺陷 Tab |

**兼容性**：直接访问 `/dashboard/requirement`、`/dashboard/task`、`/dashboard/defect` 时，重定向至 `/dashboard/project`（或默认项目详情页，由实现决定）。

### 4.3 交互逻辑表

#### 一级导航（侧边栏）

| 页面/组件 | 交互点 | 触发 | 前置条件 | 行为 | 结果/状态 | 异常/边界 |
|-----------|--------|------|----------|------|-----------|-----------|
| 侧边栏 | 项目 | 点击 | 无 | 跳转至 /dashboard/project | 项目列表页 | - |
| 侧边栏 | 概览/奖励/通知/设置 | 点击 | 无 | 跳转至对应页面 | 对应页面 | - |
| 侧边栏 | 需求/任务/缺陷 | - | - | 从主导航移除 | - | - |

#### 项目列表页

| 页面/组件 | 交互点 | 触发 | 前置条件 | 行为 | 结果/状态 | 异常/边界 |
|-----------|--------|------|----------|------|-----------|-----------|
| 项目卡片 | 卡片主体 | 点击 | 无 | 跳转至 /dashboard/project/[id] | 项目详情页，需求 Tab | - |
| 项目卡片 | 「更多」菜单 | 点击 | 无 | 展开编辑/删除等 | 菜单展开 | 编辑打开抽屉，删除执行删除 |
| 项目列表 | 新建按钮 | 点击 | 无 | 打开新建项目抽屉/弹窗 | 新建表单 | - |
| 项目列表 | 空状态 | 进入页面 | 无项目 | 显示空状态+新建引导 | - | - |

#### 项目详情页顶部栏

| 页面/组件 | 交互点 | 触发 | 前置条件 | 行为 | 结果/状态 | 异常/边界 |
|-----------|--------|------|----------|------|-----------|-----------|
| 顶部栏 | 文件夹图标 | 点击 | 无 | 跳转至 /dashboard/project | 项目列表页 | - |
| 顶部栏 | 项目名/下拉箭头 | 点击 | 无 | 展开项目下拉菜单 | 菜单展示项目列表+「返回项目列表」 | - |
| 顶部栏 | 项目下拉-某项目 | 点击 | 菜单已展开 | 1. 更新 URL 2. 刷新内容 | 切换至该项目的详情页 | - |
| 顶部栏 | 项目下拉-返回项目列表 | 点击 | 菜单已展开 | 跳转至 /dashboard/project | 项目列表页 | - |
| 顶部栏 | 需求 Tab | 点击 | 无 | 1. 切换 Tab 高亮 2. 展示需求内容 3. 更新 URL query | 需求 Tab 选中 | - |
| 顶部栏 | 任务 Tab | 点击 | 无 | 同上 | 任务 Tab 选中 | - |
| 顶部栏 | 缺陷 Tab | 点击 | 无 | 同上 | 缺陷 Tab 选中 | code 项目显示，life 可隐藏 |

#### 项目详情页内容区

| 页面/组件 | 交互点 | 触发 | 前置条件 | 行为 | 结果/状态 | 异常/边界 |
|-----------|--------|------|----------|------|-----------|-----------|
| 需求 Tab 内容 | 需求列表/看板 | 进入/切换 | 需求 Tab 选中 | 请求 /api/requirements?projectId=xxx，渲染 | 展示需求 | 空→空状态；失败→错误提示 |
| 任务 Tab 内容 | 任务列表 | 进入/切换 | 任务 Tab 选中 | 请求任务 API（带 projectId），渲染 | 展示任务 | 同上 |
| 缺陷 Tab 内容 | 缺陷列表 | 进入/切换 | 缺陷 Tab 选中 | 请求缺陷 API（带 projectId），渲染 | 展示缺陷 | life 项目→隐藏或空状态提示 |

### 4.4 校验规则

| 场景 | 规则 | 错误提示 |
|------|------|----------|
| 访问无效 projectId | projectId 不存在或已删除 | 重定向至项目列表，toast「项目不存在」 |
| 缺陷 Tab（life 项目） | life 类型项目无缺陷概念 | 隐藏缺陷 Tab，或显示「仅代码项目有缺陷」 |

---

## 5. 非功能需求

| 类型 | 要求 |
|------|------|
| 性能 | Tab 切换不整页刷新，内容区局部更新；项目下拉菜单可懒加载 |
| 安全 | 项目访问需校验用户权限（若有多用户） |
| 兼容性 | 与现有 API、数据结构兼容；需求/任务/缺陷 API 需支持 projectId 筛选 |
| 可用性 | 顶部栏在移动端可横向滚动或折叠；Tab 在小屏下保持可点击 |

---

## 6. 验收标准

| 编号 | 验收项 | 验收方式 |
|------|--------|----------|
| AC-01 | 一级导航仅含概览、项目、奖励、通知、设置 | 侧边栏不显示需求、任务、缺陷 |
| AC-02 | 点击项目卡片进入项目详情页 | 跳转至 /dashboard/project/[id]，顶部显示项目名 |
| AC-03 | 项目详情页顶部栏包含文件夹图标、项目名、需求/任务/缺陷 Tab | 布局与视觉参考一致 |
| AC-04 | 点击文件夹图标返回项目列表 | 跳转至 /dashboard/project |
| AC-05 | 项目名下拉可切换项目、选择返回项目列表 | 下拉菜单功能正常 |
| AC-06 | 需求/任务/缺陷 Tab 切换正确展示对应内容 | 内容按当前项目筛选 |
| AC-07 | 直接访问 /dashboard/requirement 等旧路径 | 重定向至项目列表或默认项目详情 |
| AC-08 | 项目详情页编辑入口 | 通过内容区或顶部栏可打开项目编辑（抽屉/弹窗） |

---

## 7. 范围与排期

### 7.1 本期范围（In Scope）

- 一级导航重构（移除需求、任务、缺陷）
- 项目列表页点击卡片进入项目详情页
- 项目详情页顶部栏：文件夹图标、项目名、下拉、需求/任务/缺陷 Tab
- 返回项目列表（文件夹图标、下拉菜单）
- 项目切换（下拉菜单）
- 需求/任务/缺陷 Tab 内容按 projectId 筛选
- 路由设计：/dashboard/project、/dashboard/project/[id]
- 旧路径重定向

### 7.2 下期范围（Out of Scope）

- 习惯、每日、待办在导航中的最终归属（本期可保留在概览内）
- 项目详情页内新建需求/任务/缺陷的快捷入口优化

### 7.3 里程碑

| 阶段 | 交付物 | 预计时间 |
|------|--------|----------|
| 开发 | 导航重构 + 项目详情页 + Tab 内容 | 待定 |
| 测试 | 通过 AC-01 ~ AC-08 | 待定 |

---

## 8. 附录

### 8.1 术语表

| 术语 | 定义 |
|------|------|
| 一级导航 | 侧边栏主导航，用户进入 Dashboard 后首先看到的导航项 |
| 二级导航 | 项目详情页内的 Tab，如需求、任务、缺陷 |
| 项目详情页 | 选中某项目后展示的页面，含顶部栏与 Tab 内容区 |

### 8.2 API 扩展说明

**需求 API**：`GET /api/requirements?projectId=xxx`，若现有 API 无 projectId，需新增 query 参数。

**任务 API**：需支持 `projectId` 筛选，若当前为 mock 数据，需在客户端或服务端按 projectId 过滤。

**缺陷 API**：同上，需支持 `projectId` 筛选。

### 8.3 与「项目管理增强」PRD 的关系

本 PRD 与 `product-designs/项目管理增强-20260201/prd.md` 为独立需求。项目管理增强侧重项目描述编辑器、状态、时间字段、详情抽屉精简；本 PRD 侧重导航架构与项目详情页布局。两者可并行开发，需注意项目详情页的「编辑」入口与 ProjectDrawer 的衔接。
