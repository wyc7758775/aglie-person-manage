# 项目弹窗优化 产品需求文档

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档版本 | v1.0 |
| 作者 | |
| 创建日期 | 2026-02-11 |
| 更新日期 | 2026-02-11 |
| 状态 | 草稿 |

---

## 1. 背景与目标

### 1.1 背景

当前项目创建/编辑弹窗（ProjectModal）在用户体验和代码组织方面存在优化空间：ESC 关闭体验不完整、积分计算交互不够直观、组件复用度低、主题色不够灵活。为提升产品易用性和可维护性，需要对弹窗进行全面优化。

### 1.2 目标

- 优化 ESC 关闭弹窗的交互体验，防止误操作导致编辑内容丢失
- 改进积分计算区域的 UI 布局，使其更紧凑直观
- 调整积分基数，让积分价值感更强（1 积分 = 1 元）
- 统一弹窗视觉风格，优化 label/value 的对比度
- 提升组件复用性，建立 UI 组件库
- 支持动态主题色，为后续个性化设置做准备
- 移除编辑态动画，减少视觉干扰
- 简化项目类型为两种：冲刺项目（Sprint）和慢速项目（Slow）

### 1.3 成功指标

| 指标 | 目标值 | 衡量方式 |
|------|--------|----------|
| ESC 关闭体验 | 编辑时有二次确认 | 测试编辑状态下按 ESC 弹出确认框 |
| 积分计算交互 | 单选框紧邻 label | UI 审查通过 |
| 积分基数 | 10 倍于当前 | 代码审查确认 |
| 组件复用 | 抽离到 UI 库 | 新组件被多处引用 |
| 主题色 | 可配置 | 主题配置对象可修改主色 |

---

## 2. 用户与场景

### 2.1 目标用户

| 用户类型 | 描述 | 核心诉求 |
|----------|------|----------|
| 个人用户 | 使用项目广场管理生活/代码项目 | 流畅的弹窗交互、直观的积分设置、简洁的视觉体验 |

### 2.2 使用场景

| 场景 | 描述 | 频率 |
|------|------|------|
| 创建项目 | 填写项目信息并提交 | 中 |
| 编辑项目 | 修改已有项目信息 | 高 |
| 设置积分 | 配置项目积分值 | 中 |
| 切换项目类型 | 选择 sprint 或 slow 类型 | 中 |

### 2.3 用户故事

- **作为** 个人用户，**我希望** 按 ESC 关闭弹窗时有二次确认，**以便** 防止误操作丢失编辑内容
- **作为** 个人用户，**我希望** 积分设置区域紧凑直观，**以便** 快速理解自动计算逻辑
- **作为** 个人用户，**我希望** 积分值更有价值感，**以便** 更有动力完成任务
- **作为** 个人用户，**我希望** 弹窗视觉风格统一简洁，**以便** 专注填写内容
- **作为** 个人用户，**我希望** 项目类型简单明了，**以便** 快速选择适合的类型

---

## 3. 功能需求

### 3.1 功能列表

| 功能模块 | 功能点 | 优先级 | 说明 |
|----------|--------|--------|------|
| 弹窗交互 | ESC 关闭 + 二次确认 | P0 | 编辑态下 ESC 触发确认弹窗 |
| 积分设置 | 自动计算单选框优化 | P0 | 单选框紧邻 label，默认选中 |
| 积分计算 | 基数乘以 10 | P0 | 所有积分默认值 ×10 |
| 视觉优化 | label/value 对比度 | P1 | label 颜色比 value 淡 |
| 布局优化 | 创建按钮位置 | P1 | 按钮放在弹窗右下角 |
| 布局优化 | 时间显示格式 | P1 | 仅显示年月日，去掉时分秒 |
| 布局优化 | 编辑模式底部 | P1 | 编辑时移除底部操作栏空白 |
| 组件化 | 抽离 UI 组件库 | P1 | 弹窗内组件可复用 |
| 主题系统 | 动态主题色 | P2 | 主题色可配置，默认与登录页一致 |
| 动画优化 | 移除编辑态动画 | P2 | 删除编辑态到文本态的过渡动画 |
| 项目类型 | 简化为两种类型 | P0 | sprint-project 🏃‍♂️ 和 slow-project 🐢 |

### 3.2 功能详细描述

#### 功能 A：ESC 关闭弹窗 + 二次确认

**描述**：用户按下 ESC 键可关闭弹窗，但当表单处于编辑状态（有未保存的修改）时，显示二次确认对话框，防止误操作丢失数据。

**用户流程**：
1. 用户打开创建/编辑项目弹窗
2. 用户修改任意表单字段（标记为编辑态）
3. 用户按下 ESC 键
4. 系统检测到编辑态，显示确认对话框：「确定放弃添加的内容吗？」
5. 用户选择「确定」→ 关闭弹窗，丢弃修改
6. 用户选择「取消」→ 保持弹窗打开，保留修改

**业务规则**：
- 编辑态判定：任意字段值与初始值不同
- 新建弹窗：初始值为空，输入任意内容即进入编辑态
- 编辑弹窗：初始值为加载的项目数据
- 确认对话框使用系统默认样式或统一 Dialog 组件
- 确认对话框内容统一为：「确定放弃添加的内容吗？」

**异常处理**：
- 无

---

#### 功能 B：积分设置区域优化

**描述**：将「自动计算」勾选框移动到积分 label 右侧，使布局更紧凑。勾选框默认选中，添加 tooltip 提示说明。

**用户流程**：
1. 用户看到积分设置区域
2. 「积分」label 右侧显示勾选框「自动计算」
3. 鼠标悬停勾选框时显示 tooltip：「根据项目优先级自动计算积分值」
4. 默认选中状态下，积分输入框禁用或隐藏
5. 用户取消选中后，积分输入框启用，可手动输入

**业务规则**：
- 勾选框默认选中（true）
- 选中时：积分自动根据项目优先级计算
- 未选中时：积分可手动输入
- UI 布局：label 和勾选框同行，整体更紧凑
- 勾选框文字缩短为「自动计算」，添加 tooltip 提示完整说明

**UI 布局示意**：
```
积分 [自动计算 ☑️] [? tooltip]
[积分输入框 - 自动计算时禁用/隐藏]
```

**表单字段排序**：
| 顺序 | 字段名 | 说明 |
|------|--------|------|
| 1 | 背景图 | 图片上传，限制高度 190px，视觉突出但不遮挡其他内容 |
| 2 | 项目名称 | 必填 |
| 3 | 项目类型 | sprint-project / slow-project |
| 4 | 优先级 | 低/中/高 |
| 5 | 积分 | 与项目状态同行 |
| 6 | 项目状态 | 与积分同行，两列布局 |
| 7 | 开始时间 | 日期选择 |
| 8 | 结束时间 | 日期选择 |
| 9 | 描述 | 文本域 |

**移除字段**：
- 目标（Goals）：已移除
- 标签（Tags）：已移除

**表单美观性优化**：
- 背景图高度调整为 190px，更加突出视觉重点
- 背景图区域使用独立卡片样式，圆角边框，不遮挡其他表单内容
- 减少字段后，增加适当的间距（space-y-6）保持视觉平衡
- 保留进度条和时间戳作为信息补充，不占用主要表单区域

**异常处理**：
- 无

---

#### 功能 C：积分基数调整

**描述**：将所有积分相关的默认计算基数乘以 10，使 1 积分等值于 1 元，提升用户对积分价值的感知。

**用户流程**：
1. 用户创建项目或任务
2. 系统自动计算积分时，使用新基数（原基数 ×10）
3. 用户看到更大的积分值（如原 5 分 → 现 50 分）

**业务规则**：
- 所有积分计算逻辑统一调整
- 优先级对应积分示例：
  - 低优先级：原 10 分 → 现 100 分
  - 中优先级：原 20 分 → 现 200 分
  - 高优先级：原 30 分 → 现 300 分
- 后端存储值同步调整，或保持原值前端显示时 ×10

**异常处理**：
- 历史数据：若后端保持原值，需确认前端显示逻辑一致

---

#### 功能 D：弹窗视觉优化

**描述**：优化弹窗内 label 和 value 的视觉层次，使 label 颜色比 value 更淡，提升可读性。

**用户流程**：
1. 用户打开弹窗
2. 表单 label 使用较淡的颜色（如 text-gray-400）
3. 输入值/选项使用较深的颜色（如 text-gray-900）
4. 整体视觉层次更清晰

**业务规则**：
- Label 颜色：使用低对比度颜色（如 gray-400 或 gray-500）
- Value 颜色：使用高对比度颜色（如 gray-900 或 black）
- 统一应用到所有表单字段

**异常处理**：
- 无

---

#### 功能 E：创建按钮位置调整

**描述**：将弹窗底部的「创建项目」/「保存」按钮放置在弹窗底部右侧，符合主流交互习惯。

**用户流程**：
1. 用户填写完表单
2. 目光自然移动到右下角找到操作按钮
3. 点击按钮提交表单

**业务规则**：
- 按钮位置：弹窗底部右侧
- 按钮对齐：右对齐
- 按钮顺序（若有多个）：主要操作在右，次要操作在左

**异常处理**：
- 无

---

#### 功能 E1：时间显示格式优化

**描述**：将创建时间和更新时间的显示格式从完整的日期时间（年月日时分秒）简化为仅显示年月日，使界面更简洁。

**用户流程**：
1. 用户查看项目详情
2. 时间戳区域显示「创建时间：2026/2/11」格式
3. 不再显示时分秒信息

**业务规则**：
- 显示格式：YYYY/MM/DD（本地化格式）
- 适用于创建时间和更新时间
- 编辑模式和查看模式均适用

**异常处理**：
- 无

---

#### 功能 E2：编辑模式底部布局优化

**描述**：编辑项目时移除底部操作栏的空白区域，使时间戳区域更贴近底部，提升空间利用率。

**用户流程**：
1. 用户编辑已有项目
2. 底部不显示创建按钮（仅新建模式显示）
3. 时间戳区域直接贴近底部，无多余空白

**业务规则**：
- 新建模式：显示底部操作栏和创建按钮
- 编辑模式：隐藏底部操作栏，时间戳下方无额外边距
- 保持视觉整洁

**异常处理**：
- 无

---

#### 功能 F：组件抽离到 UI 库

**描述**：将弹窗内使用的通用组件（如输入框、选择器、单选框、日期选择器等）抽离到 UI 组件库，供其他模块复用。

**用户流程**：
1. 开发者需要用到表单组件
2. 从 UI 库导入对应组件
3. 配置 props 使用

**待抽离组件清单**：
| 组件名 | 用途 | 位置 |
|--------|------|------|
| Modal | 弹窗容器 | components/ui/modal.tsx |
| FormInput | 文本输入框 | components/ui/form-input.tsx |
| FormSelect | 下拉选择器 | components/ui/form-select.tsx |
| FormRadio | 单选框 | components/ui/form-radio.tsx |
| FormDatePicker | 日期选择器 | components/ui/form-date-picker.tsx |
| FormLabel | 表单标签 | components/ui/form-label.tsx |
| ConfirmDialog | 确认对话框 | components/ui/confirm-dialog.tsx |

**业务规则**：
- 组件需支持 TypeScript
- 组件需可配置主题色
- 组件需有完整 props 定义
- 保持现有功能不变

**异常处理**：
- 无

---

#### 功能 G：动态主题色

**描述**：将组件的主题色改为可配置，默认与登录界面提示框颜色（#f97316 / orange-500）保持一致，为后续添加动态主题设置做准备。

**用户流程**：
1. 系统初始化时加载主题配置
2. 组件根据主题配置渲染颜色
3. 后续支持用户自定义主题色

**业务规则**：
- 主题配置对象包含主色、辅色等
- 默认主色与登录界面提示框颜色一致（#f97316 / orange-500）
- 使用 CSS 变量或主题上下文传递配置
- 组件通过主题上下文获取颜色值

**主题配置结构示例**：
```typescript
interface ThemeConfig {
  primary: string;      // 主色
  primaryLight: string; // 主色浅色
  primaryDark: string;  // 主色深色
  // ... 其他颜色
}
```

**异常处理**：
- 无

---

#### 功能 H：移除编辑态动画

**描述**：删除项目详情中编辑态切换到文本态的过渡动画，减少视觉干扰，提升响应速度。

**用户流程**：
1. 用户在项目详情中点击编辑
2. 直接切换到编辑态，无过渡动画
3. 保存或取消后直接切换回文本态，无过渡动画

**业务规则**：
- 移除所有编辑态 ↔ 文本态的 CSS transition/animation
- 保持其他必要的动画（如弹窗出现/消失）

**异常处理**：
- 无

---

#### 功能 I：项目类型简化

**描述**：将项目类型简化为两种：冲刺项目（Sprint Project）⚡ 和长期项目（Long-term Project）🌱，简化用户选择。

**用户流程**：
1. 用户创建项目时选择项目类型
2. 下拉选项显示两种类型及对应表情：
   - ⚡ 冲刺项目（Sprint Project）- 短期、高强度、快速迭代
   - 🌱 长期项目（Long-term Project）- 长期、持续成长、稳步推进
3. 选择后显示对应表情和类型名称

**业务规则**：
- 类型值：`sprint-project` 和 `slow-project`
- 显示格式：表情 + 中文名 + 英文名
- 表情固定：冲刺项目用 ⚡，长期项目用 🌱
- 迁移规则：原 `life` 类型 → `slow-project`，原 `code` 类型 → `sprint-project`

**类型对照表**：
| 新类型 | 表情 | 中文名 | 英文名 | 原类型映射 |
|--------|------|--------|--------|------------|
| sprint-project | ⚡ | 冲刺项目 | Sprint Project | code |
| slow-project | 🌱 | 长期项目 | Long-term Project | life |

**异常处理**：
- 历史数据需迁移，见数据迁移说明

---

## 4. 交互逻辑（前端）

### 4.1 原型链接

| 项目 | 内容 |
|------|------|
| 墨刀原型 | 无 |

### 4.2 交互逻辑表

#### 项目弹窗（ProjectModal）

| 页面/组件 | 交互点 | 触发 | 前置条件 | 行为 | 结果/状态 | 异常/边界 |
|-----------|--------|------|----------|------|-----------|-----------|
| 项目弹窗 | ESC 键 | 键盘按下 | 弹窗打开 | 1. 检查是否编辑态 2. 是→显示确认对话框 3. 否→直接关闭 | 关闭弹窗或显示确认 | 无 |
| 项目弹窗 | 确认对话框-确定 | 点击 | 确认对话框显示 | 关闭弹窗，丢弃修改 | 弹窗关闭 | 无 |
| 项目弹窗 | 确认对话框-取消 | 点击 | 确认对话框显示 | 关闭确认对话框，保留弹窗 | 确认框关闭，弹窗保持 | 无 |
| 项目弹窗 | 自动计算单选框 | 点击 | 无 | 1. 切换选中状态 2. 更新积分输入框状态 | 单选框状态切换 | 无 |
| 项目弹窗 | 项目类型选择 | 选择 | 无 | 显示选中类型的表情+名称 | 类型更新 | 无 |
| 项目弹窗 | 创建/保存按钮 | 点击 | 表单验证通过 | 1. 提交表单 2. 关闭弹窗 | 项目创建/更新 | 验证失败→显示错误 |

### 4.3 校验规则

| 字段 | 规则 | 错误提示 |
|------|------|----------|
| 项目名称 | 必填，1–200 字符 | 请输入项目名称 / 名称不能超过 200 个字符 |
| 项目类型 | 必填，二选一 | 请选择项目类型 |
| 积分 | 自动计算时为只读，手动时为必填正整数 | 请输入有效的积分值 |

---

## 5. 非功能需求

| 类型 | 要求 |
|------|------|
| 性能 | 弹窗打开 < 300ms，ESC 响应 < 100ms |
| 安全 | 表单提交需验证用户权限 |
| 兼容性 | 支持键盘操作，符合 a11y 标准 |
| 可维护性 | 组件抽离后需有 Storybook 或文档说明 |

---

## 6. 验收标准

| 编号 | 验收项 | 验收方式 |
|------|--------|----------|
| AC-01 | ESC 关闭弹窗，编辑态下显示二次确认 | 测试编辑状态下按 ESC |
| AC-02 | 积分设置区域紧凑，单选框紧邻 label | UI 审查 |
| AC-03 | 自动计算单选框默认选中 | 代码审查 + 功能测试 |
| AC-04 | 积分基数乘以 10 | 代码审查 |
| AC-05 | Label 颜色比 value 淡 | UI 审查 |
| AC-06 | 创建/保存按钮在右下角 | UI 审查 |
| AC-07 | 组件抽离到 UI 库并可复用 | 代码审查 + 被其他模块引用 |
| AC-08 | 主题色可配置 | 修改主题配置对象，确认颜色变化 |
| AC-09 | 编辑态无过渡动画 | 功能测试 |
| AC-10 | 项目类型为两种，显示正确表情 | 功能测试 |

---

## 7. 范围与排期

### 7.1 本期范围（In Scope）

- ESC 关闭弹窗 + 二次确认
- 积分设置区域 UI 优化
- 积分基数 ×10
- 弹窗 label/value 视觉优化
- 创建按钮位置调整
- UI 组件抽离
- 动态主题色支持
- 移除编辑态动画
- 项目类型简化为 sprint-project 和 slow-project

### 7.2 下期范围（Out of Scope）

- 用户自定义主题色界面
- 更多项目类型
- 积分规则自定义

### 7.3 里程碑

| 阶段 | 交付物 | 预计时间 |
|------|--------|----------|
| 开发 | 完成上述功能 | 待定 |
| 测试 | 通过 AC-01 ~ AC-10 | 待定 |

---

## 8. 附录

### 8.1 术语表

| 术语 | 定义 |
|------|------|
| ESC 关闭 | 按下键盘 ESC 键关闭弹窗 |
| 编辑态 | 表单字段值与初始值不同的状态 |
| 自动计算 | 根据优先级自动计算积分值 |
| 主题色 | UI 主色调，可动态配置 |
| Sprint Project | 冲刺项目，短期高强度快速迭代 |
| Long-term Project | 长期项目，持续成长稳健推进 |

### 8.2 数据迁移说明

**项目类型迁移**：

| 原类型 | 新类型 | 说明 |
|--------|--------|------|
| life | slow-project | 生活类项目映射为慢速项目 |
| code | sprint-project | 代码类项目映射为冲刺项目 |

**积分数据迁移**：

方案 A（前端显示 ×10）：
- 后端保持原值存储
- 前端显示时统一 ×10
- 前端提交时 ÷10

方案 B（后端数据迁移）：
- 执行 SQL 更新所有积分值 ×10
- 前后端直接使用新值

建议采用方案 A，避免数据迁移风险。

### 8.3 技术依赖

- React Hook Form（表单管理）
- Framer Motion（弹窗动画，编辑态动画需移除）
- Tailwind CSS（样式）
- TypeScript（类型安全）
