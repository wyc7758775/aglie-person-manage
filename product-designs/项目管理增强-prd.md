# 项目管理增强 产品需求文档

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档版本 | v1.0 |
| 作者 | |
| 创建日期 | 2026-02-01 |
| 更新日期 | 2026-02-01 |
| 状态 | 草稿 |

---

## 1. 背景与目标

### 1.1 背景

当前项目管理模块面向个人用户的项目广场，已具备项目 CRUD、状态筛选、抽屉式详情编辑等基础能力。用户反馈希望功能更加清晰明了，包括：项目描述支持富文本编辑、状态语义更贴近实际、时间字段命名更准确、详情界面减少干扰性操作入口。

### 1.2 目标

- 提升项目描述的编辑体验，支持 Markdown 格式
- 简化项目状态语义，使「正常 / 有风险 / 失控」更直观
- 统一时间字段命名（开始时间、截止时间），减少歧义
- 优化项目详情界面，移除冗余提示与过于显眼的删除入口

### 1.3 成功指标

| 指标 | 目标值 | 衡量方式 |
|------|--------|----------|
| 描述编辑体验 | 支持 MD 语法 | 可输入并渲染 Markdown |
| 状态选项 | 3 个 | 下拉仅显示：正常、有风险、失控 |
| 界面简洁度 | 无冗余提示 | 详情底部无「修改后自动保存」、无删除按钮 |

---

## 2. 用户与场景

### 2.1 目标用户

| 用户类型 | 描述 | 核心诉求 |
|----------|------|----------|
| 个人用户 | 使用项目广场管理生活/代码项目 | 清晰的状态反馈、便捷的富文本描述、简洁的详情界面 |

### 2.2 使用场景

| 场景 | 描述 | 频率 |
|------|------|------|
| 编辑项目描述 | 在详情中编写项目说明，需支持标题、列表、链接等 | 中 |
| 更新项目状态 | 根据进展将项目标记为正常/有风险/失控 | 高 |
| 设置时间范围 | 填写开始时间与截止时间 | 中 |
| 查看项目详情 | 打开抽屉查看并编辑项目信息 | 高 |

### 2.3 用户故事

- **作为** 个人用户，**我希望** 在项目描述中使用 Markdown 编辑，**以便** 更好地组织说明内容
- **作为** 个人用户，**我希望** 项目状态为「正常 / 有风险 / 失控」，**以便** 快速判断项目健康度
- **作为** 个人用户，**我希望** 时间字段显示为「开始时间」「截止时间」，**以便** 语义更清晰
- **作为** 个人用户，**我希望** 项目详情界面简洁，**以便** 专注查看与编辑，减少误操作

---

## 3. 功能需求

### 3.1 功能列表

| 功能模块 | 功能点 | 优先级 | 说明 |
|----------|--------|--------|------|
| 项目描述 | 引入 Tiptap MD 编辑器 | P0 | 替换现有 textarea，支持 Markdown |
| 项目状态 | 状态选项调整为三值 | P0 | 正常、有风险、失控 |
| 时间字段 | 标签与语义调整 | P0 | 开始日期→开始时间，结束日期→截止时间 |
| 项目详情 | 移除删除入口与自动保存提示 | P0 | 详情抽屉底部移除删除按钮和「修改后自动保存」 |

### 3.2 功能详细描述

#### 功能 A：项目描述引入 Tiptap MD 编辑器

**描述**：将项目描述字段从普通 textarea 替换为基于 Tiptap 的 Markdown 编辑器，支持标题、列表、粗体、链接等常用格式。

**用户流程**：
1. 打开项目详情抽屉
2. 在描述区域点击进入编辑
3. 使用工具栏或 Markdown 语法输入内容
4. 失焦或切换字段时自动保存（沿用现有自动保存逻辑）

**业务规则**：
- 存储格式为 Markdown 字符串，与现有 `description` 字段兼容
- 新建项目时描述可为空
- 编辑模式下支持所见即所得或源码模式（由 Tiptap 扩展决定）

**异常处理**：
- 网络保存失败 → 显示错误提示，保留本地输入
- 超长内容 → 按后端限制校验（如有）

---

#### 功能 B：项目状态下拉值调整为三值

**描述**：将项目状态从当前的 planning / active / paused / completed 调整为：正常、有风险、失控。

**用户流程**：
1. 在项目详情或新建表单中打开状态下拉
2. 选择「正常」「有风险」「失控」之一
3. 选择后自动保存（编辑模式）或随表单提交（新建模式）

**业务规则**：
- 状态为必填
- 三值对应：`normal`（正常）、`at_risk`（有风险）、`out_of_control`（失控）
- 项目列表页筛选需同步调整（若当前按状态筛选，需映射新值）
- 历史数据迁移：需定义 planning/active/paused/completed 到新三值的映射规则

**异常处理**：
- 无

---

#### 功能 C：开始日期→开始时间，结束日期→截止时间

**描述**：将时间相关字段的 UI 标签与语义调整：开始日期改为开始时间，结束日期改为截止时间。可选支持日期时间选择器以提升精度。

**用户流程**：
1. 在项目详情或新建表单中看到「开始时间」「截止时间」标签
2. 通过日期或日期时间选择器填写
3. 保存后正确展示

**业务规则**：
- 开始时间：必填，不能晚于截止时间（若截止时间已填）
- 截止时间：可选，不能早于开始时间
- 存储格式保持 ISO 8601 字符串，与现有 API 兼容
- 后端字段名可保持 `startDate`、`endDate`，仅前端展示与校验逻辑调整

**异常处理**：
- 截止时间早于开始时间 → 校验不通过，提示「截止时间不能早于开始时间」

---

#### 功能 D：项目详情界面精简

**描述**：在项目详情抽屉（ProjectDrawer 编辑模式）中，移除删除项目入口和「修改后自动保存」提示。

**用户流程**：
1. 点击项目卡片打开详情抽屉
2. 底部操作栏不再显示删除按钮
3. 底部不再显示「修改后自动保存」文字

**业务规则**：
- 删除功能仍可通过项目卡片上的「更多」菜单（三点菜单）触发，仅从详情抽屉内移除
- 自动保存逻辑不变，仅移除提示文案

**异常处理**：
- 无

---

## 4. 交互逻辑（前端）

### 4.1 原型链接

| 项目 | 内容 |
|------|------|
| 墨刀原型 | 无 |

### 4.2 交互逻辑表

#### 项目详情抽屉（ProjectDrawer）

| 页面/组件 | 交互点 | 触发 | 前置条件 | 行为 | 结果/状态 | 异常/边界 |
|-----------|--------|------|----------|------|-----------|-----------|
| 项目详情抽屉 | 描述字段 | 点击/聚焦 | 无 | 1. 展示 Tiptap MD 编辑器 2. 可输入 Markdown | 编辑态 | 空描述显示占位符 |
| 项目详情抽屉 | 描述字段 | 失焦 | 有修改 | 1. 调用保存 API 2. 更新 SaveStatusIndicator | 保存成功/失败 | 失败→显示错误，保留输入 |
| 项目详情抽屉 | 状态下拉 | 选择 | 无 | 1. 更新本地状态 2. 调用保存 API | 状态更新 | - |
| 项目详情抽屉 | 开始时间/截止时间 | 选择日期 | 无 | 1. 更新本地状态 2. 调用保存 API | 时间更新 | 截止时间早于开始时间→校验失败 |
| 项目详情抽屉 | 底部操作栏 | 进入编辑模式 | 非新建 | 1. 不显示删除按钮 2. 不显示「修改后自动保存」 | 界面简洁 | - |
| 项目列表 | 项目卡片「更多」菜单 | 点击 | 无 | 显示编辑、删除等选项 | 菜单展开 | 删除仍由此入口触发 |

### 4.3 校验规则

| 字段 | 规则 | 错误提示 |
|------|------|----------|
| 项目名称 | 必填，1–200 字符 | 请输入项目名称 / 名称不能超过 200 个字符 |
| 开始时间 | 必填 | 请选择开始时间 |
| 截止时间 | 可选，不能早于开始时间 | 截止时间不能早于开始时间 |
| 状态 | 必填，三选一 | - |

---

## 5. 非功能需求

| 类型 | 要求 |
|------|------|
| 性能 | Tiptap 编辑器首次加载需在 2s 内完成 |
| 安全 | 描述内容需做 XSS 过滤（Tiptap 默认处理） |
| 兼容性 | 与现有项目 API、数据结构兼容，历史数据需迁移策略 |
| 可用性 | 状态、时间字段在移动端可正常操作 |

---

## 6. 验收标准

| 编号 | 验收项 | 验收方式 |
|------|--------|----------|
| AC-01 | 项目描述使用 Tiptap MD 编辑器 | 打开详情，描述区域可输入并渲染 Markdown |
| AC-02 | 状态下拉仅显示正常、有风险、失控 | 新建/编辑时状态选项为上述三值 |
| AC-03 | 时间字段标签为「开始时间」「截止时间」 | 表单与详情中标签正确显示 |
| AC-04 | 详情抽屉底部无删除按钮 | 编辑模式下底部不显示删除 |
| AC-05 | 详情抽屉底部无「修改后自动保存」 | 编辑模式下底部无该提示 |
| AC-06 | 修改后仍可自动保存 | 编辑任意字段后，SaveStatusIndicator 正常反馈保存状态 |

---

## 7. 范围与排期

### 7.1 本期范围（In Scope）

- 项目描述引入 Tiptap MD 编辑器
- 项目状态调整为：正常、有风险、失控
- 开始日期→开始时间，结束日期→截止时间（标签与校验）
- 项目详情抽屉移除删除按钮与「修改后自动保存」提示

### 7.2 下期范围（Out of Scope）

- 项目列表筛选逻辑与状态映射的完整重构（若本期仅做抽屉内状态选项调整）
- 描述字段的图片上传、@提及等高级能力
- 开始时间/截止时间支持纯时间选择（不含日期）

### 7.3 里程碑

| 阶段 | 交付物 | 预计时间 |
|------|--------|----------|
| 开发 | 完成上述 4 项功能 | 待定 |
| 测试 | 通过 AC-01 ~ AC-06 | 待定 |

---

## 8. 附录

### 8.1 术语表

| 术语 | 定义 |
|------|------|
| Tiptap | 基于 ProseMirror 的富文本编辑器框架，支持 Markdown 扩展 |
| 正常 / 有风险 / 失控 | 项目健康度三档状态，对应 normal / at_risk / out_of_control |
| 开始时间 / 截止时间 | 项目时间范围的起止，对应原 startDate / endDate |

### 8.2 数据迁移说明

**状态字段迁移**：现有 `planning` / `active` / `paused` / `completed` 需映射到新三值，建议规则：

| 原状态 | 新状态 |
|--------|--------|
| planning | normal |
| active | normal |
| paused | at_risk |
| completed | out_of_control |

或根据业务另行定义。

### 8.3 技术依赖

- Tiptap 相关包：`@tiptap/react`、`@tiptap/starter-kit`、`@tiptap/extension-placeholder` 等（具体以选型为准）
- 现有项目 API 保持不变，仅前端字段展示与校验调整
